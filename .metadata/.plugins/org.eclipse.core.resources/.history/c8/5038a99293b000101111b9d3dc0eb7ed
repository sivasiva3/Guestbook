<%@ include file="/init.jsp" %>
<%@ taglib uri="http://liferay.com/tld/aui" prefix="aui" %>
<%@ taglib uri="http://java.sun.com/portlet_2_0" prefix="portlet" %>
<portlet:defineObjects />
<%@ taglib uri="http://liferay.com/tld/ui" prefix="liferay-ui" %>

<%@ taglib uri="http://liferay.com/tld/theme" prefix="liferay-theme" %>
<liferay-theme:defineObjects />
    
<%@ page import="com.liferay.docs.guestbook.service.GuestbookEntryLocalServiceUtil" %>
<%@ page import="com.liferay.portal.kernel.util.WebKeys" %>
<%@ page import="com.liferay.portal.kernel.util.ParamUtil" %>
<%@ page import="com.liferay.portal.kernel.util.HtmlUtil" %>
<%@ page import="com.liferay.petra.string.StringPool" %>
<%@ page import="com.liferay.docs.guestbook.model.Guestbook" %>
<%@ page import="com.liferay.docs.guestbook.service.GuestbookLocalServiceUtil" %>
<%@ page import="java.util.List" %>
  
<%
	long guestbookId = ParamUtil.getLong(request, "guestbookId");
	if (guestbookId == 0 && renderRequest.getAttribute("guestbookId") != null) {
	    guestbookId = (Long) renderRequest.getAttribute("guestbookId");
	}
	 if (guestbookId == 0) {
	        List<Guestbook> guestbooks = GuestbookLocalServiceUtil.getGuestbooks(scopeGroupId);
	        if (!guestbooks.isEmpty()) {
	            guestbookId = guestbooks.get(0).getGuestbookId();
	        }
	    }

%>
<h3>Welcome to our office</h3>
 <aui:button-row cssClass="guestbook-buttons">
 <portlet:renderURL var="addEntryURL">
 	<portlet:param name="mvcPath" value="/guestbook/edit_entry.jsp"></portlet:param>
 	 <portlet:param name="guestbookId" value="<%=String.valueOf(guestbookId)%>" />
 </portlet:renderURL>

 	<aui:button onClick="<%= addEntryURL.toString() %>" value="Add Entry"></aui:button>
 </aui:button-row>
 
 <liferay-ui:search-container total="<%= GuestbookEntryLocalServiceUtil.getGuestbookEntriesCount()%>">
 	<liferay-ui:search-container-results results="<%=GuestbookEntryLocalServiceUtil.getGuestbookEntries(Math.toIntExact(scopeGroupId.longValue()),Math.toIntExact(guestbookId))  %>"/>
 	<liferay-ui:search-container-row className="com.liferay.docs.guestbook.model.GuestbookEntry" modelVar="entry">
 		<liferay-ui:search-container-column-text property="name"/>
 		<liferay-ui:search-container-column-text property="email"/>
 		<liferay-ui:search-container-column-text property="message"/>
 		<liferay-ui:search-container-column-jsp align="center" path="/guestbook/entry_actions.jsp"/>
 	</liferay-ui:search-container-row>
 	<liferay-ui:search-iterator></liferay-ui:search-iterator>
</liferay-ui:search-container>

<% 
	List<Guestbook> gbs=GuestbookLocalServiceUtil.getGuestbooks(scopeGroupId);
	Guestbook curGuestbook;
	for(int i=0; i<gbs.size(); i++){
		curGuestbook=(Guestbook) gbs.get(i);
		String cssClass=StringPool.BLANK;
		if(curGuestbook.getGuestbookId()==guestbookId){
			cssClass="active";
		}
%>
<portlet:renderURL var="viewPageURL">
	<portlet:param name="mvcPath" value="/guestbook/view.jsp"/>
	<portlet:param name="guestbookId" value="<%= String.valueOf(curGuestbook.getGuestbookId()) %>"/>
</portlet:renderURL>
<aui:nav-item cssClass="<%=cssClass %>" href="<%=viewPageURL %>" label="<%= HtmlUtil.escape(curGuestbook.getName()) %>"/>
<%
	}
%>